#define NUM_GAUSSIANS 278
const uvec3 gaussian_data[NUM_GAUSSIANS] = uvec3[](
    uvec3(2234070583u, 2171214072u, 310530716u),
    uvec3(689378828u, 3890066341u, 141108717u),
    uvec3(3692237580u, 4231020605u, 212818584u),
    uvec3(2137948541u, 4275492778u, 75243813u),
    uvec3(2299136002u, 1251978487u, 38145337u),
    uvec3(2183146272u, 3860012546u, 429094933u),
    uvec3(2803177751u, 771321096u, 56233587u),
    uvec3(1966293315u, 1625932701u, 171461504u),
    uvec3(3608286220u, 3005968305u, 41484921u),
    uvec3(2231699459u, 2065572466u, 194727719u),
    uvec3(2268612677u, 3092527523u, 245179452u),
    uvec3(1765494099u, 2219729080u, 39129405u),
    uvec3(4281222482u, 2193384763u, 21692747u),
    uvec3(4284446596u, 1778326252u, 232852961u),
    uvec3(2064981010u, 3123038635u, 175066392u),
    uvec3(1968203894u, 1811989434u, 259592057u),
    uvec3(486277119u, 1201107427u, 118818581u),
    uvec3(974460174u, 642293016u, 126817952u),
    uvec3(1456924411u, 1987668458u, 82774030u),
    uvec3(3284917492u, 2939123121u, 63636427u),
    uvec3(387060234u, 4145384646u, 321149266u),
    uvec3(3876656143u, 3957822818u, 141901441u),
    uvec3(3231097550u, 2113368985u, 47711405u),
    uvec3(1968004697u, 3998149015u, 266165780u),
    uvec3(4286550982u, 1011188817u, 81530192u),
    uvec3(3878500146u, 14748u, 423976992u),
    uvec3(624445254u, 410893822u, 322517238u),
    uvec3(3912912206u, 30964954u, 207903627u),
    uvec3(643466909u, 3637621365u, 117573598u),
    uvec3(1898722342u, 60605u, 544034395u),
    uvec3(655298310u, 3601434411u, 132133229u),
    uvec3(3143201132u, 2878459053u, 278796063u),
    uvec3(604900873u, 780244412u, 58792421u),
    uvec3(263309567u, 993230003u, 96014594u),
    uvec3(4278651965u, 2292481164u, 23200253u),
    uvec3(1445408310u, 1585735751u, 23005674u),
    uvec3(4285037731u, 1570019682u, 21038120u),
    uvec3(392395979u, 2068475794u, 27921097u),
    uvec3(4218060717u, 1492947456u, 44763837u),
    uvec3(1542257407u, 1933142638u, 26217295u),
    uvec3(4293327103u, 1687446565u, 20054322u),
    uvec3(488843312u, 1519676831u, 16253355u),
    uvec3(602666495u, 1412591525u, 43647642u),
    uvec3(2134065733u, 1619874191u, 137247179u),
    uvec3(407393883u, 509966914u, 67372036u),
    uvec3(450486229u, 1553033798u, 21037377u),
    uvec3(3792901131u, 1752987925u, 80218477u),
    uvec3(3497625999u, 377123528u, 65080447u),
    uvec3(510429871u, 966298675u, 64357334u),
    uvec3(2716069887u, 2053078210u, 28182960u),
    uvec3(2120514493u, 1789100327u, 39718657u),
    uvec3(4278979584u, 1584296913u, 39978282u),
    uvec3(838926609u, 1832348942u, 14091468u),
    uvec3(3923634942u, 1497984013u, 19531520u),
    uvec3(2672517771u, 2038537847u, 48368136u),
    uvec3(369098752u, 1556510066u, 18679761u),
    uvec3(1842408447u, 1984717506u, 17171879u),
    uvec3(2432702539u, 1725130238u, 11732229u),
    uvec3(4291945714u, 2333109564u, 102368794u),
    uvec3(3701653480u, 2538567547u, 25232569u),
    uvec3(3567566502u, 863623290u, 115345120u),
    uvec3(2956150600u, 3154333383u, 133632892u),
    uvec3(2047806987u, 1559654143u, 38404682u),
    uvec3(4222072810u, 1427994409u, 75761831u),
    uvec3(3343606417u, 2324991817u, 92997910u),
    uvec3(73233578u, 1257604678u, 145821737u),
    uvec3(1954386356u, 2432269421u, 22676711u),
    uvec3(2414342911u, 2124381836u, 27528127u),
    uvec3(4202074308u, 1447135305u, 72748490u),
    uvec3(3109975710u, 2976939920u, 88868355u),
    uvec3(2019985537u, 930932957u, 295446138u),
    uvec3(2416522163u, 1284601238u, 34800670u),
    uvec3(2333816249u, 1858626529u, 22349131u),
    uvec3(861038744u, 2108460539u, 55839668u),
    uvec3(4284774505u, 3987926670u, 234558316u),
    uvec3(1740627199u, 2318363328u, 41619823u),
    uvec3(4106082801u, 2631035883u, 44958382u),
    uvec3(2818572310u, 1829989502u, 15663343u),
    uvec3(2470598260u, 2595132216u, 128388556u),
    uvec3(4478823u, 2469236110u, 70257723u),
    uvec3(428976873u, 2150006045u, 38012807u),
    uvec3(3048126953u, 1988193738u, 38011460u),
    uvec3(4132464270u, 2073007745u, 45682270u),
    uvec3(2388884398u, 2150344654u, 59442059u),
    uvec3(4281879380u, 866341583u, 208342123u),
    uvec3(754974719u, 2051702014u, 61670317u),
    uvec3(3954233338u, 1509122951u, 16318713u),
    uvec3(2855684203u, 2825882224u, 82511083u),
    uvec3(1933201491u, 3075974088u, 88611109u),
    uvec3(3528811087u, 3475720112u, 62528393u),
    uvec3(2251902033u, 1672239800u, 76358045u),
    uvec3(4281680192u, 1331967191u, 340333641u),
    uvec3(3634281215u, 1224832641u, 165809437u),
    uvec3(363515135u, 1909813053u, 12780857u),
    uvec3(1766220454u, 2110494668u, 56623968u),
    uvec3(1924251369u, 2701621081u, 46924492u),
    uvec3(2510469631u, 1966833955u, 52496915u),
    uvec3(2604815994u, 2357698192u, 51318845u),
    uvec3(2670208018u, 3075564067u, 69405331u),
    uvec3(3748498369u, 2086568536u, 89326931u),
    uvec3(1934453633u, 1025950034u, 221715939u),
    uvec3(123823549u, 2646178337u, 14615298u),
    uvec3(4114503776u, 1117564254u, 16646398u),
    uvec3(4282077827u, 3260124343u, 97126230u),
    uvec3(2757915251u, 1097950845u, 15271609u),
    uvec3(363248104u, 2325839321u, 17433295u),
    uvec3(3467756513u, 2447930654u, 45418686u),
    uvec3(4285958330u, 2076945475u, 20840766u),
    uvec3(769062655u, 1952082281u, 109971086u),
    uvec3(578921215u, 2164879639u, 105777490u),
    uvec3(3999035021u, 1546882889u, 27330909u),
    uvec3(3091750274u, 1597612015u, 44761771u),
    uvec3(2574556113u, 934835650u, 62326146u),
    uvec3(525494624u, 3006093884u, 131076330u),
    uvec3(761626492u, 3802712561u, 81397914u),
    uvec3(4611423u, 2137806470u, 129763260u),
    uvec3(3512693952u, 2509929110u, 48235773u),
    uvec3(467596031u, 2092590365u, 35783361u),
    uvec3(1421399021u, 1761110035u, 12715419u),
    uvec3(478247292u, 1146216334u, 158009707u),
    uvec3(458647414u, 1605213165u, 14681562u),
    uvec3(2621526133u, 2951780378u, 31395287u),
    uvec3(2137685617u, 1098540671u, 22414563u),
    uvec3(629327094u, 1028091517u, 46400196u),
    uvec3(4282139957u, 10528u, 120466831u),
    uvec3(3561181012u, 2436183655u, 139397199u),
    uvec3(10409471u, 2290187913u, 23200098u),
    uvec3(5071200u, 2348999242u, 243676711u),
    uvec3(1446002237u, 2931207078u, 169683651u),
    uvec3(807166600u, 1429958567u, 29754150u),
    uvec3(4284184478u, 1288673239u, 136513571u),
    uvec3(1214742448u, 2224064365u, 37553013u),
    uvec3(2141961471u, 2433183345u, 50989501u),
    uvec3(3460256334u, 1001006232u, 432744374u),
    uvec3(3186555903u, 1375825473u, 45353961u),
    uvec3(6192294u, 1105302399u, 144182110u),
    uvec3(1909517567u, 2475845593u, 12912038u),
    uvec3(3374198345u, 139568025u, 90637671u),
    uvec3(4282666888u, 2726593540u, 38275995u),
    uvec3(1269878517u, 2836164690u, 29297179u),
    uvec3(2170385560u, 1865654814u, 19728337u),
    uvec3(1881553514u, 1788324934u, 10879596u),
    uvec3(1977085695u, 2400282798u, 23530079u),
    uvec3(4282536527u, 2208574679u, 279582598u),
    uvec3(1286594303u, 2952753611u, 14550631u),
    uvec3(389236321u, 3071186787u, 22085969u),
    uvec3(8821458u, 2712500990u, 25756072u),
    uvec3(3916532945u, 1987738444u, 52365774u),
    uvec3(3839487186u, 2218684005u, 48759543u),
    uvec3(1867277957u, 2965407509u, 124520300u),
    uvec3(625235571u, 3166474832u, 76350605u),
    uvec3(3327484019u, 331316038u, 21367147u),
    uvec3(2487376739u, 680746192u, 147143723u),
    uvec3(830580163u, 3090577142u, 18678585u),
    uvec3(1918793654u, 1896066120u, 21497225u),
    uvec3(914334921u, 3015079740u, 38667680u),
    uvec3(2798449407u, 1670603782u, 16975415u),
    uvec3(4115026766u, 864792808u, 37159479u),
    uvec3(3939357183u, 2649909560u, 17301768u),
    uvec3(311272191u, 1943170154u, 28707165u),
    uvec3(1253100273u, 2720098955u, 12059370u),
    uvec3(3781129898u, 1706863627u, 22413816u),
    uvec3(443120561u, 1526429645u, 21629322u),
    uvec3(4279117408u, 1733526109u, 37618294u),
    uvec3(4060111280u, 1118335400u, 83232353u),
    uvec3(3637241599u, 2711975033u, 42599436u),
    uvec3(4284117166u, 2514847195u, 55510978u),
    uvec3(1555350226u, 1562600562u, 18089044u),
    uvec3(4214343u, 1591269918u, 170134052u),
    uvec3(3763434717u, 2367584179u, 49875831u),
    uvec3(1968138346u, 3092488133u, 40374726u),
    uvec3(3609273369u, 3730526724u, 110375069u),
    uvec3(4283724176u, 1529844401u, 29035563u),
    uvec3(3295640962u, 960456691u, 17040050u),
    uvec3(3247226335u, 909209887u, 30082601u),
    uvec3(4282802083u, 2276173438u, 27263881u),
    uvec3(1700684645u, 421883971u, 47646586u),
    uvec3(732215255u, 1861512186u, 16451393u),
    uvec3(3912582985u, 2509332200u, 135661590u),
    uvec3(511018661u, 2116921909u, 25952652u),
    uvec3(1933529411u, 2081740326u, 74189806u),
    uvec3(3294784115u, 480998885u, 31392223u),
    uvec3(72645297u, 1441622529u, 41091699u),
    uvec3(3745141596u, 2277990460u, 90178912u),
    uvec3(3550264257u, 2472900608u, 30279335u),
    uvec3(1966424378u, 1083242075u, 164643640u),
    uvec3(632473075u, 2222160509u, 23265635u),
    uvec3(580229958u, 1534356159u, 20971840u),
    uvec3(3248272068u, 2014864552u, 19595891u),
    uvec3(3846527836u, 1102099392u, 54264636u),
    uvec3(4289511152u, 2088204991u, 34013703u),
    uvec3(3696643380u, 4069928074u, 99290286u),
    uvec3(2829375996u, 1070755776u, 61934119u),
    uvec3(1951823220u, 1133565595u, 124525506u),
    uvec3(3950397u, 2763809264u, 138741829u),
    uvec3(3665003649u, 3711555332u, 152439062u),
    uvec3(23424627u, 410218220u, 36769347u),
    uvec3(2554945174u, 2131405485u, 18089919u),
    uvec3(3499467962u, 1683055835u, 15335658u),
    uvec3(1818258338u, 1644652901u, 24314527u),
    uvec3(2723970223u, 2932308806u, 66454518u),
    uvec3(41192173u, 2694740344u, 32901989u),
    uvec3(2088671124u, 3992182433u, 130819311u),
    uvec3(1817139794u, 4143895589u, 26020725u),
    uvec3(3496839342u, 2035983811u, 42730124u),
    uvec3(1873594093u, 1898340696u, 10289805u),
    uvec3(1245136205u, 442476577u, 45487110u),
    uvec3(2702578954u, 567248008u, 134809609u),
    uvec3(1418305195u, 2787994936u, 13174162u),
    uvec3(2560404429u, 1750360609u, 11011286u),
    uvec3(6781327u, 1084726323u, 45351678u),
    uvec3(1832929922u, 2543222737u, 37749312u),
    uvec3(2743442887u, 3004397632u, 25232278u),
    uvec3(4288790001u, 2251848122u, 18415897u),
    uvec3(2143739893u, 2312660782u, 12715421u),
    uvec3(7767607u, 713414713u, 54461584u),
    uvec3(708331835u, 2394953090u, 222956874u),
    uvec3(5599122u, 1852484137u, 33227602u),
    uvec3(2757254463u, 3616946651u, 71110050u),
    uvec3(4290104548u, 2197317441u, 15073510u),
    uvec3(2217886016u, 1317581424u, 89859990u),
    uvec3(1429218820u, 3809430997u, 313332397u),
    uvec3(2790945715u, 1504214385u, 39846593u),
    uvec3(2756135997u, 866674180u, 24839354u),
    uvec3(1598044974u, 3216140292u, 30607681u),
    uvec3(3419795682u, 2486921895u, 55575376u),
    uvec3(540894901u, 1602643098u, 34079240u),
    uvec3(2671660117u, 3203564020u, 24576375u),
    uvec3(3158461801u, 1664131360u, 21496136u),
    uvec3(3198533102u, 2821878850u, 74646643u),
    uvec3(10731748u, 2651616606u, 13828559u),
    uvec3(4289907158u, 2570611398u, 33686018u),
    uvec3(1062492485u, 3534305798u, 128780205u),
    uvec3(2084063847u, 1347722491u, 57871299u),
    uvec3(3146365644u, 2702601553u, 38928978u),
    uvec3(1279613823u, 906465241u, 46925372u),
    uvec3(2339011212u, 2033036530u, 13894169u),
    uvec3(4115295132u, 2789046128u, 59376994u),
    uvec3(611024502u, 721743897u, 124193563u),
    uvec3(2218677917u, 1776332075u, 16777927u),
    uvec3(3240109349u, 671186334u, 46334659u),
    uvec3(4285300863u, 2496388081u, 135990661u),
    uvec3(1109866552u, 2774054074u, 186452765u),
    uvec3(4038247925u, 2218294345u, 22610657u),
    uvec3(3191294578u, 1774496000u, 20972441u),
    uvec3(2908584625u, 2187169220u, 85132563u),
    uvec3(674973025u, 1765779558u, 24772986u),
    uvec3(4281941820u, 601843201u, 82709201u),
    uvec3(2585799279u, 2040572258u, 44830762u),
    uvec3(2974571347u, 3662869496u, 64884058u),
    uvec3(1898854718u, 1918717028u, 286217909u),
    uvec3(2267557410u, 3708660696u, 241521602u),
    uvec3(2065441314u, 3110731916u, 227959904u),
    uvec3(4285104766u, 3641761996u, 92870842u),
    uvec3(4285632188u, 856915145u, 65275397u),
    uvec3(3662834058u, 1963760727u, 21825067u),
    uvec3(4676694u, 2901343906u, 634463697u),
    uvec3(4282208966u, 1812423909u, 68289554u),
    uvec3(2944117966u, 1321364850u, 52036990u),
    uvec3(3747506549u, 1679600850u, 11010216u),
    uvec3(256530799u, 161582219u, 86318484u),
    uvec3(1772932574u, 2559010875u, 10618032u),
    uvec3(2250984799u, 2917586259u, 61020225u),
    uvec3(2234595369u, 1345108065u, 206900309u),
    uvec3(2743188475u, 2542301618u, 31130981u),
    uvec3(2202427233u, 1241014116u, 63708174u),
    uvec3(3043853677u, 701944812u, 65799148u),
    uvec3(1914688u, 2083766808u, 124327299u),
    uvec3(3403211007u, 2289790661u, 61670317u),
    uvec3(1488508923u, 2104517617u, 15336095u),
    uvec3(321600076u, 2948109088u, 96273853u),
    uvec3(979463803u, 1060476979u, 63900464u),
    uvec3(4284576370u, 2400091073u, 39715911u),
    uvec3(977822367u, 1583383702u, 57869171u),
    uvec3(3676181771u, 3024514554u, 52626211u),
    uvec3(2671792019u, 1986897202u, 25692016u),
    uvec3(3747379857u, 865307695u, 28967742u),
    uvec3(493121925u, 1901895987u, 35455517u)
);

struct Gaussian {
    vec3 rgb;
    vec2 pos;
    vec2 scale;
    float cos_theta;
    float sin_theta;
};

Gaussian unpackGaussian(uvec3 data) {
    uint u0 = data.x;
    uint u1 = data.y;
    uint u2 = data.z;

    uint R = (u0 >> 0u) & 255u;
    uint G = (u0 >> 8u) & 255u;
    uint B = (u0 >> 16u) & 255u;
    uint theta_quant = (u0 >> 24u) & 255u;

    uint mu_x_quant = u1 & 65535u;
    uint mu_y_quant = (u1 >> 16u) & 65535u;

    uint sigma_1_quant = u2 & 65535u;
    uint sigma_2_quant = (u2 >> 16u) & 65535u;

    vec3 rgb = vec3(float(R), float(G), float(B)) / 255.0;
    vec2 pos = vec2(float(mu_x_quant), float(mu_y_quant)) / 65535.0;
    vec2 scale = vec2(float(sigma_1_quant), float(sigma_2_quant)) / 65535.0;
    float theta = float(theta_quant) / 255.0 * 3.1415926535;
    float cos_theta = cos(theta);
    float sin_theta = sin(theta);

    Gaussian g;
    g.rgb = rgb;
    g.pos = pos;
    g.scale = scale;
    g.cos_theta = cos_theta;
    g.sin_theta = sin_theta;
    return g;
}

precision highp float;
void mainImage(out vec4 fragColor, in vec2 fragCoord)
{
    float aspect = 1.515625;
    vec2 uv = fragCoord / iResolution.xy;
    uv.y = 1.0 - uv.y;
    float canvasAspect = iResolution.x / iResolution.y;
    if (canvasAspect > aspect) {
        float scale = canvasAspect / aspect;
        uv.x = (uv.x - 0.5) * scale + 0.5;
    } else {
        float scale = aspect / canvasAspect;
        uv.y = (uv.y - 0.5) * scale + 0.5;
    }
    vec3 color = vec3(0.0);
    for (int i = NUM_GAUSSIANS - 1; i >= 0; --i)
    {
        Gaussian g = unpackGaussian(gaussian_data[i]);
        vec2 d = uv - g.pos;
        vec2 d_scaled = vec2(d.x * aspect, d.y);
        vec2 d_rot = vec2(
            g.cos_theta * d_scaled.x + g.sin_theta * d_scaled.y,
            -g.sin_theta * d_scaled.x + g.cos_theta * d_scaled.y
        );
        float alpha = exp(-0.5 * (
            (d_rot.x * d_rot.x) / (g.scale.x * g.scale.x) +
            (d_rot.y * d_rot.y) / (g.scale.y * g.scale.y)
        ));
        color = mix(color, g.rgb, alpha);
    }
    fragColor = vec4(color, 1.0);
}
